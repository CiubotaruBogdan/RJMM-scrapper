javascript:(async function(){let m;try{m=JSON.parse(localStorage.getItem('article_meta')||'null');}catch(e){}if(!m||!m.title){try{const t=await navigator.clipboard.readText();m=JSON.parse(t);}catch(e){}}if(!m||!m.title){const t=prompt('Paste metadata JSON');if(t)try{m=JSON.parse(t);}catch(e){alert('Invalid JSON');}}if(!m||!m.title){alert('Still no metadata found');return;}const $=s=>document.querySelector(s);const $$=s=>document.querySelectorAll(s);$('#title').value=m.title||'';$('#post_wpcfdoi').value=m.doi||'';$('#post_wpcfabstract').value=m.abstract||'';$('#post_wpcfarticle-file').value=m.article_file||'';$('#post_wpcfarticle_received').value=m.received_date||'';$('#post_wpcfarticle_revised').value=m.revised_date||'';$('#post_wpcfarticle_accepted').value=m.accepted_date||'';$('#post_wpcfacademic-editor').value=m.academic_editor||'';$('#post_wpcfcitation').value=m.citation||'';$('#post_wpcfcorrespondence').value=m.correspondence_full?'Correspondence: '+m.correspondence_full:'';if(m.keywords){const kw=$('#new-tag-keyword');if(kw){kw.value=m.keywords;kw.nextElementSibling.click();}}if(m.article_type){$$('input[type="checkbox"]').forEach(cb=>{const label=cb.closest('label');if(label&&label.textContent.trim()===m.article_type){cb.checked=true;cb.dispatchEvent(new Event('change',{bubbles:true}));}});}if(m.issue){const afterPeriod=m.issue.split('.').pop().trim();const words=afterPeriod.split(/[,\s]+/).filter(w=>w.trim());const lastTwoWords=words.slice(-2).join(', ');$$('input[type="checkbox"]').forEach(cb=>{const label=cb.closest('label');if(label&&cb.name.includes('tax_input[issue]')&&label.textContent.trim().includes(lastTwoWords)){cb.checked=true;cb.dispatchEvent(new Event('change',{bubbles:true}));cb.dispatchEvent(new Event('click',{bubbles:true}));}});}if(m.year){$$('input[type="checkbox"]').forEach(cb=>{const label=cb.closest('label');if(label&&label.textContent.trim()===m.year&&cb.name.includes('tax_input[issue-year]')){cb.checked=true;cb.dispatchEvent(new Event('change',{bubbles:true}));}});}if(m.affiliations&&m.affiliations.length){for(let i=0;i<m.affiliations.length;i++){let addBtn=null;const allElements=$$('a,button');for(let el of allElements){if(el.textContent.includes('Add')&&(el.textContent.includes('Affiliation')||el.textContent.includes('first'))){addBtn=el;break;}}if(addBtn){addBtn.click();await new Promise(r=>setTimeout(r,500));}else{break;}}await new Promise(r=>setTimeout(r,1000));const affInputs=$$('input[name*="affiliation"], input[placeholder*="affiliation"], input[id*="affiliation"]');for(let i=0;i<Math.min(m.affiliations.length,affInputs.length);i++){if(affInputs[i]){affInputs[i].value=m.affiliations[i];affInputs[i].dispatchEvent(new Event('input',{bubbles:true}));affInputs[i].dispatchEvent(new Event('change',{bubbles:true}));}}if(affInputs.length===0){const allInputs=$$('input[type="text"]');const lastInputs=Array.from(allInputs).slice(-m.affiliations.length);for(let i=0;i<Math.min(m.affiliations.length,lastInputs.length);i++){if(lastInputs[i]){lastInputs[i].value=m.affiliations[i];lastInputs[i].dispatchEvent(new Event('input',{bubbles:true}));lastInputs[i].dispatchEvent(new Event('change',{bubbles:true}));}}}}setTimeout(()=>alert('Fields filled âœ” (including '+m.affiliations.length+' affiliations)'),500);})().catch(err=>alert(err.message||err));

